diff -urap1 a/src/m4.h b/src/m4.h
--- a/src/m4.h	2021-05-07 23:42:02.000000000 +0200
+++ b/src/m4.h	2026-01-09 02:14:30.000000000 +0100
@@ -48,2 +48,3 @@
 #include "filenamecat.h"
+#include "intprops.h"
 #include "obstack.h"
diff -urap1 a/src/Makefile.in b/src/Makefile.in
--- a/src/Makefile.in	2021-05-28 20:48:49.000000000 +0200
+++ b/src/Makefile.in	2026-01-09 17:55:48.000000000 +0100
@@ -1,5 +1,5 @@
-# Makefile.in generated by automake 1.16.3 from Makefile.am.
+# Makefile.in generated by automake 1.18.1 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994-2020 Free Software Foundation, Inc.
+# Copyright (C) 1994-2025 Free Software Foundation, Inc.
 
@@ -73,2 +73,4 @@ am__make_dryrun = (target_option=n; $(am
 am__make_keepgoing = (target_option=k; $(am__make_running_with_option))
+am__rm_f = rm -f $(am__rm_f_notfound)
+am__rm_rf = rm -rf $(am__rm_f_notfound)
 pkgdatadir = $(datadir)/@PACKAGE@
@@ -335,4 +337,2 @@ am__define_uniq_tagged_files = \
   done | $(am__uniquify_input)`
-ETAGS = etags
-CTAGS = ctags
 am__DIST_COMMON = $(srcdir)/Makefile.in \
@@ -366,2 +366,4 @@ CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CSCOPE = @CSCOPE@
+CTAGS = @CTAGS@
 CXX = @CXX@
@@ -384,2 +386,3 @@ EOVERFLOW_VALUE = @EOVERFLOW_VALUE@
 ERRNO_H = @ERRNO_H@
+ETAGS = @ETAGS@
 EXEEXT = @EXEEXT@
@@ -1878,4 +1881,6 @@ am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
+am__rm_f_notfound = @am__rm_f_notfound@
 am__tar = @am__tar@
 am__untar = @am__untar@
+am__xargs_n = @am__xargs_n@
 bindir = @bindir@
@@ -2007,6 +2012,6 @@ uninstall-binPROGRAMS:
 	echo " ( cd '$(DESTDIR)$(bindir)' && rm -f" $$files ")"; \
-	cd "$(DESTDIR)$(bindir)" && rm -f $$files
+	cd "$(DESTDIR)$(bindir)" && $(am__rm_f) $$files
 
 clean-binPROGRAMS:
-	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+	-$(am__rm_f) $(bin_PROGRAMS)
 
@@ -2036,3 +2041,3 @@ $(am__depfiles_remade):
 	@$(MKDIR_P) $(@D)
-	@echo '# dummy' >$@-t && $(am__mv) $@-t $@
+	@: >>$@
 
@@ -2172,4 +2177,4 @@ clean-generic:
 distclean-generic:
-	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
-	-test . = "$(srcdir)" || test -z "$(CONFIG_CLEAN_VPATH_FILES)" || rm -f $(CONFIG_CLEAN_VPATH_FILES)
+	-$(am__rm_f) $(CONFIG_CLEAN_FILES)
+	-test . = "$(srcdir)" || $(am__rm_f) $(CONFIG_CLEAN_VPATH_FILES)
 
@@ -2183,3 +2188,3 @@ clean-am: clean-binPROGRAMS clean-generi
 distclean: distclean-am
-		-rm -f ./$(DEPDIR)/builtin.Po
+	-rm -f ./$(DEPDIR)/builtin.Po
 	-rm -f ./$(DEPDIR)/debug.Po
@@ -2239,3 +2244,3 @@ installcheck-am:
 maintainer-clean: maintainer-clean-am
-		-rm -f ./$(DEPDIR)/builtin.Po
+	-rm -f ./$(DEPDIR)/builtin.Po
 	-rm -f ./$(DEPDIR)/debug.Po
@@ -2289 +2294,8 @@ uninstall-am: uninstall-binPROGRAMS
 .NOEXPORT:
+
+# Tell GNU make to disable its built-in pattern rules.
+%:: %,v
+%:: RCS/%,v
+%:: RCS/%
+%:: s.%
+%:: SCCS/s.%
diff -urap1 a/src/output.c b/src/output.c
--- a/src/output.c	2021-05-10 23:30:01.000000000 +0200
+++ b/src/output.c	2026-01-09 02:17:23.000000000 +0100
@@ -29,2 +29,8 @@
 
+/* Work around a bogus GCC warning
+   <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=116426>.  */
+#if __GNUC__ >= 6
+# pragma GCC diagnostic ignored "-Wnull-dereference"
+#endif
+
 /* Size of initial in-memory buffer size for diversions.  Small diversions
@@ -193,7 +199,9 @@ m4_tmpname (int divnum)
     {
-      tail = xasprintf ("%s/m4-%d", output_temp_dir->dir_name, INT_MAX);
-      buffer = (char *) obstack_copy0 (&diversion_storage, tail,
-                                       strlen (tail));
-      free (tail);
-      tail = strrchr (buffer, '-') + 1;
+      size_t dirlen = strlen (output_temp_dir->dir_name);
+      static char const subprefix[] = "/m4-";
+      size_t size = dirlen + sizeof subprefix + INT_STRLEN_BOUND (int);
+      buffer = obstack_alloc (&diversion_storage, size);
+      memcpy (buffer, output_temp_dir->dir_name, dirlen);
+      memcpy (buffer + dirlen, subprefix, sizeof subprefix - 1);
+      tail = buffer + dirlen + sizeof subprefix - 1;
     }
